(function(){function K(a){a.addEventListener(scrt.connection.Events.FATAL_ERROR,function(a){return g.connection.onError(a.message)},"legacy-connection-fatal-error");a.addEventListener(scrt.connection.Events.MESSAGE_RECEIVED,function(a){return g.connection.messageHandler(a.type.toString(),a.body)},"legacy-connection-message-received");a.addEventListener(scrt.connection.Events.RECONNECTING,function(){return g.connection.onReconnect(!1)},"legacy-connection-reconnecting");a.addEventListener(scrt.connection.Events.RECONNECTED,
function(){return g.connection.onReconnect(!0)},"legacy-connection-reconnected");a.addEventListener(scrt.connection.Events.REINIT,function(){return g.connection.onReInit()},"legacy-connection-reinit");a.addEventListener(scrt.connection.Events.LONG_POLL_COMPLETED,function(){return g.connection.onLongPoll()},"legacy-connection-longpoll-completed")}function z(){var a=[],b=[],c=null,e=null;return{complete:function(b){if(null!=c)return c&&window.setTimeout(function(){b.call(window,e)},1),this;a.push(b);
return this},error:function(a){if(null!=c)return c||window.setTimeout(function(){a.call(window,e)},1),this;b.push(a);return this},callback:function(d,g){c=d;e=g;(d?a:b).forEach(function(a){(a=a.call(window,g))&&(g=a)});return this}}}function x(){this.getPublicInterface=function(){var a;this.lockedPublicInterface||(a=this.createPublicInterface(),this.lockedPublicInterface=m.finalizeObject(a));return this.lockedPublicInterface?this.lockedPublicInterface:a}}function k(a,b){window.servicepresence.dispatchEvent(a,
b)}function A(){n=q=null;for(var a=0;a<u.length;a++)D[u[a]]&&D[u[a]].call(window);m.forEachMapped(f,function(a){delete a});f.reset()}function E(a){w=!0;if(a&&0!==a.length){for(var b=f.getTotalWorkload(),c=0;c<a.length;c++)if(!f.get(a[c])){var e=new F(a[c]);f.add(e);a[c].isEngaged?k(h.WORK_ACCEPTED,e.getPublicInterface()):0<a[c].pushTimeout&&(e.timer=setTimeout(function(){e.getPublicInterface().decline(!0)},1E3*a[c].pushTimeout))}a=new r(n.getPublicInterface().getCapacity(),b,f.getTotalWorkload());
k(h.WORKLOAD_CHANGED,a.getPublicInterface())}else f.reset()}function S(a){m.forEachMapped(a,function(a,c){G[c]&&G[c].call(window,a)})}function B(a){this.createPublicInterface=function(){return{getCapacity:function(){return a.capacity},isAutoAcceptEnabled:function(){return a.isAutoAcceptEnabled},isDeclineEnabled:function(){return a.isDeclineEnabled},getStatusOnDecline:function(){return a.statusOnDecline},getStatusOnPushTimeout:function(){return a.statusOnPushTimeout},isRequestSoundEnabled:function(){return a.isRequestSoundEnabled},
isDisconnectSoundEnabled:function(){return a.isDisconnectSoundEnabled}}}}function H(a,b,c,e){for(var d=[],g=0;g<a.channels.length;g++)d.push(new L(a.channels[g]));this.createPublicInterface=function(){return{getStatusId:function(){return a.statusId},getChannels:function(){for(var a=[],b=0;b<d.length;b++)a.push(d[b].getPublicInterface());return a},hasChannel:function(a){for(var b=0;b<d.length;b++)if(d[b].getDeveloperName()==a)return!0;return!1},getChatCapacityImpactWeight:function(){return a.chatCapacityImpact.weight},
getChatCapacityImpactPercentage:function(){return a.chatCapacityImpact.percentage},getStatusName:function(){return"undefined"!==typeof a.statusDetails&&a.statusDetails?a.statusDetails.statusName:null},getStatusApiName:function(){return"undefined"!==typeof a.statusDetails&&a.statusDetails?a.statusDetails.apiName:null},getReason:function(){return b},getSupervisorName:function(){return c},getChangeTime:function(){return e}}};this.getId=function(){return a.statusId};this.getStatusId=function(){return a.statusId}}
function L(a){this.createPublicInterface=function(){return{getChannelId:function(){return a.id},getDeveloperName:function(){return a.developerName},serialize:function(a){var c={developerName:this.getDeveloperName()};34>parseFloat(a)?c.id=this.getChannelId():c.channelId=this.getChannelId();return c}}};this.getDeveloperName=function(){return a.developerName}}function F(a){var b=this;this.createPublicInterface=function(){return{getWorkId:function(){return a.workId},getWorkTargetId:function(){return a.workTargetId},
getChannelName:function(){return a.channelName},getCapacityImpact:function(){return a.capacityImpact},isEngaged:function(){return a.isEngaged},getPushTimeout:function(){return a.pushTimeout},getRequestedTime:function(){return a.psrDateAdded},isTransfer:function(){return a.isTransfer},isConference:function(){return a.isConference},getPriority:function(){return a.priority},getRoutingType:function(){return a.routingType},accept:function(){b.clearPushTimeoutTimer();return a.isConference?p.joinWork(a.workId,
a.workTargetId):p.acceptWork(a.workId,a.workTargetId)},accepted:function(){a.isEngaged=!0;k(h.WORK_ACCEPTED,b.getPublicInterface())},join:function(){b.clearPushTimeoutTimer();return p.joinWork(a.workId,a.workTargetId)},joined:function(){a.isEngaged=!0;k(h.WORK_JOINED,b.getPublicInterface())},workTransferred:function(){k(h.WORK_TRANSFERRED,b.getPublicInterface())},workTransferError:function(){k(h.WORK_TRANSFER_ERROR,b.getPublicInterface())},decline:function(c,e){if(!c||f.get(a.workId))if(void 0===
a.isEngaged||!a.isEngaged){var d=n.getPublicInterface(),d=c?d.getStatusOnPushTimeout():d.getStatusOnDecline();void 0!==d&&null!==d&&servicepresence.setStatus(d,a.workId);return p.declineWork(a.workId,c,e,a.workTargetId).complete(function(){var c=f.getTotalWorkload();f.remove(a.workId);k(h.WORK_DECLINED,b.getPublicInterface());c=new r(n.getPublicInterface().getCapacity(),c,f.getTotalWorkload());k(h.WORKLOAD_CHANGED,c.getPublicInterface())})}},cancel:function(){var a=f.getTotalWorkload();f.remove(b.getPublicInterface().getWorkId());
k(h.WORK_CANCELLED,b.getPublicInterface());a!=f.getTotalWorkload()&&(a=new r(n.getPublicInterface().getCapacity(),a,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,a.getPublicInterface()))},close:function(c){return p.closeWork(a.workId,a.workTargetId,c).complete(function(){var c=f.getTotalWorkload();f.remove(a.workId);k(h.WORK_CLOSED,b.getPublicInterface());c=new r(n.getPublicInterface().getCapacity(),c,f.getTotalWorkload());k(h.WORKLOAD_CHANGED,c.getPublicInterface())})},transferWork:function(b){return p.transferWork(a.workId,
b)},isEntity:function(){return!0},serialize:function(a){return{workId:this.getWorkId(),workItemId:this.getWorkTargetId(),isEngaged:this.isEngaged()}}}};this.clearPushTimeoutTimer=function(){void 0!==b.timer&&clearTimeout(b.timer)}}function M(a,b,c,e,d,R){I[a]||(I[a]=0);var l=++I[a],C=a+"_"+l,v=this,m=!1,N=!1,p=null,q=null;this.createPublicInterface=function(){return{getWorkId:function(){return C},getWorkTargetId:function(){return null},getClientChannelId:function(){return a},getChannelName:function(){return b},
getCapacityImpact:function(){return R},getData:function(){return c},isEntity:function(){return!1},isEngaged:function(){return m},isDeclinable:function(){return e},isAutoAcceptable:function(){return d},decline:function(){N=!0;var a=f.getTotalWorkload();f.remove(C);k(h.WORK_DECLINED,v.getPublicInterface());var b=n.getPublicInterface();e&&b.getStatusOnDecline()&&servicepresence.setStatus(b.getStatusOnDecline());q&&q.call(window,v.getPublicInterface());a!=f.getTotalWorkload()&&(a=new r(n.getPublicInterface().getCapacity(),
a,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,a.getPublicInterface()));return g.createCallbackHandler().callback(!0)},accept:function(){var a=f.getTotalWorkload();p&&p.call(window,v.getPublicInterface());m=!0;k(h.WORK_ACCEPTED,v.getPublicInterface());a!=f.getTotalWorkload()&&(a=new r(n.getPublicInterface().getCapacity(),a,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,a.getPublicInterface()));return g.createCallbackHandler().callback(!0)},onAccept:function(a){p=a;m&&a.call(window,v.getPublicInterface());
return this},onDecline:function(a){q=a;N&&a.call(window,v.getPublicInterface());return this},cancel:function(){var a=f.getTotalWorkload();f.remove(C);k(h.WORK_CANCELLED,v.getPublicInterface());a!=f.getTotalWorkload()&&(a=new r(n.getPublicInterface().getCapacity(),a,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,a.getPublicInterface()))},close:function(){var a=f.getTotalWorkload();f.remove(C);k(h.WORK_CLOSED,v.getPublicInterface());a=new r(n.getPublicInterface().getCapacity(),a,f.getTotalWorkload());k(h.WORKLOAD_CHANGED,
a.getPublicInterface())},serialize:function(a){return{workId:this.getWorkId(),workItemId:this.getWorkTargetId(),isEngaged:this.isEngaged()}}}}}function r(a,b,c){this.createPublicInterface=function(){return{getConfiguredCapacity:function(){return a},getPreviousWorkload:function(){return b},getNewWorkload:function(){return c},serialize:function(a){return{configuredCapacity:this.getConfiguredCapacity(),previousWorkload:this.getPreviousWorkload(),newWorkload:this.getNewWorkload()}}}}}function O(){var a=
null,b={inFocusWorkId:null,inFocusTime:null,omniWorks:[],timeLog:{}};this.createPublicInterface=function(){var c=this;return{init:function(c){function d(a){a=window.e||a;g="a"!==a.target.tagName.toLowerCase()||-1===a.target.href.toLowerCase().indexOf("javascript:void")&&-1===a.target.href.toLowerCase().indexOf("javascript:openpopup")?!1:!0}a=c;if(c=a.LocalStorage.getItem("SfdcApp.Presence.ActiveTime"))b=a.JSON.parse(c),b.inFocusTime=new Date(b.inFocusTime);var g=!1,f=function(a){if(g)g=!1;else if(t.sendActiveTime()&&
t.getUserAgent()&&!t.getUserAgent().isChrome){var b=LC.getLabel("ServiceDeskApp","confirm_exit_app");return a.returnValue=b}};c=!1;t.getUserAgent()&&(t.getUserAgent().isIE9||t.getUserAgent().isIE10)&&(c=!0);window.addEventListener?(c&&window.addEventListener("click",d,!1),window.addEventListener("beforeunload",function(a){return f(a)},!1)):(c&&window.attachEvent("onclick",d,!1),window.attachEvent("onbeforeunload",function(a){return f(a)},!1))},clear:function(){c.clearInFocus();b.omniWorks=[];b.timeLog=
{}},addOmniWork:function(a){-1===b.omniWorks.indexOf(a)&&b.omniWorks.push(a);this.onFocusedPrimaryTab()},removeOmniWork:function(a){b.inFocusWorkId===a&&(c.addLogEntry(new Date),c.clearInFocus());var d=null;b.timeLog.hasOwnProperty(a)&&(d=b.timeLog[a].time,delete b.timeLog[a],b.omniWorks.splice(b.omniWorks.indexOf(a),1));return c.convertToSecs(d)},onFocusedPrimaryTab:function(a){if(0<b.omniWorks.length){var d=new Date;c.addLogEntry(d);sforce.console.getFocusedPrimaryTabObjectId(function(a){-1===b.omniWorks.indexOf(a.id)?
sforce.console.getFocusedSubtabObjectId(function(a){-1===b.omniWorks.indexOf(a.id)?c.clearInFocus():(b.inFocusWorkId=a.id,b.inFocusTime=d)}):(b.inFocusWorkId=a.id,b.inFocusTime=d)})}},onFocusedSubtab:function(a){window.servicepresence.getActiveTimeTracker().onFocusedPrimaryTab()},onFocusedNavigatorPanel:function(a){0<b.omniWorks.length&&(c.addLogEntry(new Date),c.clearInFocus())}}};this.saveData=function(){if(a){var c=a.JSON.stringify(b);a.LocalStorage.setItem("SfdcApp.Presence.ActiveTime",c)}};this.addLogEntry=
function(a){b.inFocusWorkId&&(b.timeLog[b.inFocusWorkId]={time:(b.inFocusWorkId in b.timeLog?b.timeLog[b.inFocusWorkId].time:0)+a.getTime()-b.inFocusTime.getTime()})};this.clearInFocus=function(){b.inFocusWorkId=null;b.inFocusTime=null};this.getActiveTimes=function(){var a=b.inFocusWorkId,e=new Date;this.addLogEntry(e);this.clearInFocus();this.saveData();b.inFocusWorkId=a;b.inFocusTime=e;var a=[],d;for(d in b.timeLog)b.timeLog.hasOwnProperty(d)&&a.push({workEntityId:d,activeTime:this.convertToSecs(b.timeLog[d].time)});
return a};this.sendActiveTime=function(){var a=this.getActiveTimes();return 0<a.length?p.sendActiveTime(a):null};this.convertToSecs=function(a){return a?Math.ceil(a/1E3):null};this.getUserAgent=function(){return a.userAgent}}function P(a,b,c){this.createPublicInterface=function(){return{getReason:function(){return a},getSupervisorName:function(){return b},getLogoutTime:function(){return c},serialize:function(a){return{reason:this.getReason(),supervisorName:this.getSupervisorName(),logoutTime:this.getLogoutTime()}}}}}
var T=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var e in b)b.hasOwnProperty(e)&&(a[e]=b[e]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},l,y=new (function(){return function(){this.pollTimeout=4E4}}()),g={connection:{getNounPrefix:function(){return""},setEndpoint:function(a,b,c){l||(scrt.connection.isInitialized()||scrt.connection.initialize(a,b,c),l=scrt.connection.getConnection(),K(l))},start:function(a){var b=this;l.start(a).then(function(a){return b.onInit()},
function(a){return b.onError(a)})},restart:function(){l.restart(y.sessionId,y.sessionKey,y.affinityToken,y.pollTimeout);this.onInit()},stop:function(){if(null!=l){l.stop();var a=l;a.removeEventListeners("legacy-connection-fatal-error");a.removeEventListeners("legacy-connection-message-received");a.removeEventListeners("legacy-connection-reconnecting");a.removeEventListeners("legacy-connection-reconnected");a.removeEventListeners("legacy-connection-reinit");a.removeEventListeners("legacy-connection-longpoll-completed");
l=null}},createCallbackHandler:function(){return z()},send:function(a,b,c){var e=z();if(!l)return e.callback(!1,"realConnection is null");l.send({nounPrefix:this.getNounPrefix(),nounName:a,properties:b,sensitiveProperties:c}).then(function(a){return e.callback(!0,a)})["catch"](function(a){return e.callback(!1,a)});return e},setConnectionTimeout:function(a){l.setConnectionTimeout(a)},sendWithPrefix:function(a,b,c,e){var d=z();l.send({nounPrefix:a,nounName:b,properties:c}).then(function(a){return d.callback(!0,
a)})["catch"](function(a){e?e.call(window):null;d.callback(!1,a)});return d},setSessionId:function(a){y.sessionId=a},setSessionKey:function(a){y.sessionKey=a},setAffinityToken:function(a){y.affinityToken=a},isRunning:function(){return l&&l.isRunning()},getSessionId:function(){return l&&l.getSessionId()},getSessionKey:function(){return l&&l.getSessionKey()},getAffinityToken:function(){return l&&l.getAffinityToken()},serialize:function(){return JSON.parse(l.serialize())},deserialize:function(a){l=scrt.connection.deserialize(JSON.stringify(a));
K(l)},abortConnection:function(){return l&&l.abort()},onError:function(a){return null},onInit:function(){return null},onReInit:function(){return null},onLongPoll:function(){return null},messageHandler:function(a,b){return null},onReconnect:function(a){return null},reinitializeSession:function(){return null},enableOutboundMessage:function(){return null}},createCallbackHandler:function(){return z()},doRequest:function(a,b,c,e,d,f,h){var k="";e&&(k=h?h:g.connection.getNounPrefix(),k+="/");var m=z();
l.getMessenger().send(new U(k+a,l.getApiVersion(),d,b),c).then(function(a){f&&m.callback(!0,a.getData())},function(a){return m.callback(!1,{data:a.data,status:a.status})});return m}},U=function(a){function b(b,e,d,g){a.call(this,e,scrt.connection.Method.GET,g);this.data=null;this.url=b;d&&(this.data=JSON.stringify(d))}T(b,a);b.prototype.getBaseUrl=function(){return this.url};b.prototype.getBody=function(){return this.data};return b}(scrt.connection.Request),m={log:function(a){window&&window.console&&
window.console.log(a)},logGroupStart:function(a){window.console.group?window.console.groupCollapsed("LIVE AGENT: "+a):m.log("LIVE AGENT: "+a)},logGroupEnd:function(){window.console&&window.console.group&&window.console.groupEnd()},error:function(a){window&&window.console&&window.console.error?a.stack&&window.console.log?a.stack?(m.logGroupStart("Error: "+a),window.console.log("Stacktrace: "),window.console.log(a.stack),m.logGroupEnd()):window.console.error(a):window.console.error(a):m.log(a)},forEachMapped:function(a,
b){for(var c in a)a.hasOwnProperty(c)&&b.call(window,a[c],c)},finalizeObject:function(a){var b={};if(Object.defineProperty){for(var c in a)if(a.hasOwnProperty(c))try{Object.defineProperty(b,c,{value:a[c],writable:!1,enumerable:!0,configurable:!1})}catch(e){return!1}return b}return!1},endsWith:function(a,b){return-1!==a.indexOf(b,a.length-b.length)}},w=!1,q=null,n=null,t=null,J={},G={},D={},u=[],Q={},I={},f=new function(){var a={},b=0;this.add=function(c){var e=c.getPublicInterface();a[e.getWorkId()]=
c;b++};this.get=function(b){return a.hasOwnProperty(b)?a[b]:null};this.remove=function(c){a.hasOwnProperty(c)&&(delete a[c],b--)};this.getWorks=function(){var b=[];m.forEachMapped(a,function(a){b.push(a)});return b};this.reset=function(){a={};b=0};this.getTotalWorkload=function(){var a=0;m.forEachMapped(f.getWorks(),function(b){b=b.getPublicInterface();var d=!1;b.isEngaged()?d=!0:b.isEntity()?d=!0:b.getData()&&b.getData().isPushRequest()&&(d=!b.getData().getTransferSource()||b.getData().isTransferToButton());
d&&(a+=b.getCapacityImpact())});return a/100}},p={};(function(){g.PresenceMessage={PRESENCE_CONFIGURATION:"Presence/PresenceConfiguration",PRESENCE_LOGOUT:"Presence/PresenceLogout",PRESENCE_SESSION_DATA:"Presence/PresenceSessionData",PRESENCE_STATUS_CHANGED:"Presence/PresenceStatusChanged",WORK_ACCEPTED:"Presence/WorkAccepted",WORK_ASSIGNED:"Presence/WorkAssigned",WORK_CANCELED:"Presence/WorkCanceled",WORK_TRANSFER_ERROR:"Presence/WorkTransferError",WORK_TRANSFERRED:"Presence/WorkTransferred"};var a=
g.connection;p={login:function(b,c,e,d,g,f){var k=[];f||(f={});for(var h=0;h<d.length;h++)k.push({channelId:d[h],param:f[d[h]]});return a.send("PresenceLogin",{organizationId:b,sfdcSessionId:c,statusId:e,channelIdsWithParam:k,domain:g},{sfdcSessionId:!0})},resyncState:function(a,c){var e={organizationId:a,sfdcSessionId:c},d=g.connection.getSessionId(),f=g.connection.getSessionKey(),h=g.connection.getAffinityToken();return g.doRequest("PresenceResyncState/"+d,f,h,!0,e,!1)},setStatus:function(b,c,e){return a.send("PresenceStatus",
{statusId:b,channelIds:c,workDeclinedId:e})},logout:function(b){var c=function(b){return a.send("PresenceLogout",{})};return(b="undefined"!==typeof b&&b?b:t.getActiveTimes())&&0<b.length?p.sendActiveTime(b).complete(c):c()},checkSession:function(b,c,e,d,f,h,k){for(var l=[],m=0;m<d.length;m++)l.push(encodeURIComponent(d[m]).replace(",",""));return g.doRequest("PresenceSessionData/"+b+"?PresenceSessionData.sfdcSessionId\x3d"+f+(l?"\x26PresenceSessionData.clientChannels\x3d"+l.join(","):"")+(k?"\x26PresenceSessionData.domain\x3d"+
k:"")+(!0===h?"\x26PresenceSessionData.keepSequence\x3d1":""),c,e,!0,null,!0).complete(function(d){(d=d.messages[0])&&d.message.isValid&&(a.setSessionId(b),a.setSessionKey(c),a.setAffinityToken(e),h?a.reinitializeSession():a.restart())})},acceptWork:function(b,c){return a.send("AcceptWork",{workId:b,workTargetId:c})},joinWork:function(b,c){return a.send("JoinWork",{workId:b,workTargetId:c})},declineWork:function(b,c,e,d){return a.send("DeclineWork",{workId:b,onPushTimeout:c,declineReason:e,workTargetId:d})},
closeWork:function(b,c,e){return a.send("CloseWork",{workId:b,workTargetId:c,activeTime:e})},transferWork:function(b,c){return a.send("TransferWork",{workId:b,skills:c})},checkClientWork:function(b,c,e,d){return a.send("CheckClientWork",{clientChanneldId:b,clientWorkId:c,capacityImpact:e,forceCapacity:d})},sendActiveTime:function(b){return a.send("ActiveTime",{works:b})}}})();var h={LOGIN_SUCCESS:"servicePresenceLoginSuccess",LOGIN_FAILED:"servicePresenceLoginFailed",LOGOUT:"servicePresenceLogout",
RECONNECTING:"servicePresenceReconnecting",STATUS_CHANGED:"servicePresenceStatusChanged",STATUS_CHANGE_FAILED:"servicePresenceStatusChangeFailed",CONNECTION_ERROR:"servicePresenceConnectionError",RESYNC_STATE_SUCCESS:"servicePresenceResyncStateSuccess",WORK_ASSIGNED:"servicePresenceWorkAssigned",WORK_ACCEPTED:"servicePresenceWorkAccepted",WORK_DECLINED:"servicePresenceWorkDeclined",WORK_CLOSED:"servicePresenceWorkClosed",WORK_CANCELLED:"servicePresenceWorkCancelled",CONFIGURATION_UPDATED:"servicePresenceConfigurationUpdated",
WORKLOAD_CHANGED:"servicePresenceWorkloadChanged",WORK_TRANSFERRED:"servicePresenceWorkTransferred",WORK_TRANSFER_ERROR:"servicePresenceWorkTransferError"};g.connection.getNounPrefix=function(a){return"Presence"};g.connection.messageHandler=function(a,b){switch(a){case g.PresenceMessage.PRESENCE_SESSION_DATA:g.connection.enableOutboundMessage();n=new B(b.configuration);k(h.RECONNECTING,!0);k(h.RESYNC_STATE_SUCCESS,null===q?null:q.getId());m.log("Finished Resync Presence User State");break;case g.PresenceMessage.PRESENCE_LOGOUT:var c=
new P(b.reason,b.supervisorName,b.logoutTime);k(h.LOGOUT,c.getPublicInterface());w=!1;A();g.connection.isRunning()&&g.connection.stop();break;case g.PresenceMessage.PRESENCE_CONFIGURATION:c=n;n=new B(b);k(h.CONFIGURATION_UPDATED);c&&c.getPublicInterface().getCapacity()!=n.getPublicInterface().getCapacity()&&(c=new r(n.getPublicInterface().getCapacity(),f.getTotalWorkload(),f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,c.getPublicInterface()));break;case g.PresenceMessage.PRESENCE_STATUS_CHANGED:c=new H(b.status,
b.reason,b.supervisorName,b.changeTime);if(null!=q&&q.getId()===c.getId())break;q=c;c=f.getTotalWorkload();if("undefined"!==typeof b.deletedWorkItems&&null!==b.deletedWorkItems)for(var e=0;e<b.deletedWorkItems.length;e++)f.remove(b.deletedWorkItems[e]);k(h.STATUS_CHANGED,q.getPublicInterface());c!=f.getTotalWorkload()&&(c=new r(n.getPublicInterface().getCapacity(),c,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,c.getPublicInterface()));break;case g.PresenceMessage.WORK_ASSIGNED:var d=new F(b);f.get(d.getPublicInterface().getWorkId())||
(c=f.getTotalWorkload(),f.add(d),k(h.WORK_ASSIGNED,d.getPublicInterface()),c=new r(n.getPublicInterface().getCapacity(),c,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,c.getPublicInterface()),0<b.pushTimeout&&(d.timer=setTimeout(function(){d.getPublicInterface().decline(!0)},1E3*b.pushTimeout)));break;case g.PresenceMessage.WORK_CANCELED:d=f.get(b.workId);null!=d&&d.getPublicInterface().cancel();break;case g.PresenceMessage.WORK_ACCEPTED:d=f.get(b.workId);null!=d&&d.getPublicInterface().accepted();break;
case g.PresenceMessage.WORK_JOINED:d=f.get(b.workId);null!=d&&d.getPublicInterface().joined();break;case g.PresenceMessage.WORK_TRANSFERRED:d=f.get(b.workId);null!=d&&d.getPublicInterface().workTransferred();break;case g.PresenceMessage.WORK_TRANSFER_ERROR:d=f.get(b.workId);null!=d&&d.getPublicInterface().workTransferError();break;default:(c=a.substr(0,a.indexOf("/")).toLowerCase())&&J[c]?J[c].call(window,a,b):m.log("Presence: Unhandled message type: "+a)}};B.prototype=new x;H.prototype=new x;L.prototype=
new x;F.prototype=new x;M.prototype=new x;r.prototype=new x;O.prototype=new x;t=new O;P.prototype=new x;window.servicepresence||(window.servicepresence={});window.servicepresence={Events:h,login:function(a,b,c,e,d,f,l){w?m.error("You cannot login to an already initialized connection"):(w=!0,g.connection.setEndpoint(a,b,44),g.connection.onInit=function(){servicepresence.getStatus()&&servicepresence.getStatus().getStatusId()||p.login(c,e,d,u,f,Q).error(function(a){m.log("Login Failed: "+a);w=!1;g.connection.stop();
k(h.LOGIN_FAILED,{statusId:d,message:a})}).complete(function(){E();k(h.LOGIN_SUCCESS,d)})},g.connection.onError=function(a){w=!1;g.connection.stop();A();k(h.CONNECTION_ERROR,a)},g.connection.onReconnect=function(a){k(h.RECONNECTING,a)},g.connection.onResyncState=function(){k(h.RECONNECTING,!1);p.resyncState(c,e).error(function(){m.log("Service Presence ResyncState Error. Login again.");p.login(c,e,q.getId())})},g.connection.start(l?l:"classic"))},reinit:function(a,b,c,e,d,f,l,r,v,t){g.connection.setEndpoint(e,
d,44);g.connection.onReInit=function(){var a=q;A();p.login(f,l,a?a.getId():null,u,t).error(function(a){m.log("Reinit Login Failed: "+a);w=!1;g.connection.stop();k(h.LOGIN_FAILED,r)}).complete(function(){E();k(h.LOGIN_SUCCESS,r)})};g.connection.onError=function(a){w=!1;g.connection.stop();A();k(h.CONNECTION_ERROR,a)};g.connection.onReconnect=function(a){k(h.RECONNECTING,a)};g.connection.onResyncState=function(){k(h.RECONNECTING,!1);p.resyncState(f,l).error(function(){m.log("Service Presence ResyncState Error. Re-request state.");
var a=g.connection.getSessionId(),b=g.connection.getSessionKey(),c=g.connection.getAffinityToken();window.servicepresence.reinit(a,b,c,e,d,f,l,r,t)})};p.checkSession(a,b,c,u,l,v,t).complete(function(a){a=a.messages[0];null!==a&&a.message.isValid?(n=new B(a.message.configuration),v?k(h.LOGIN_SUCCESS,a.message):(q=new H(a.message.status),E(a.message.works),a.message.nativeChannelData&&S(a.message.nativeChannelData),k(h.LOGIN_SUCCESS,a.message),k(h.STATUS_CHANGED,q.getPublicInterface()))):(w=!1,k(h.LOGIN_FAILED))}).error(function(){k(h.LOGIN_FAILED);
m.log("Presence reinit failed. Re-login to obtain a new session.");window.servicepresence.login(e,d,f,l,r,t)})},logout:function(a){function b(){w=!1;var a=f.getTotalWorkload();A();g.connection.isRunning()&&g.connection.stop();k(h.LOGOUT);0!=a&&(a=new r(0,a,0),k(h.WORKLOAD_CHANGED,a.getPublicInterface()))}return p.logout(a).complete(function(){b()}).error(function(a){m.log("Logout Failed: "+a);b()})},getStatus:function(){return null!=q?q.getPublicInterface():null},setStatus:function(a,b){if(!q||a!==
q.getId())return p.setStatus(a,u,b).error(function(b){m.log("Failed to change status. "+b+" "+a);k(h.STATUS_CHANGE_FAILED,{statusId:a,message:b})})},getConfiguration:function(){return n?n.getPublicInterface():null},getWork:function(a){a=f.get(a);return null!==a?a.getPublicInterface():null},getWorks:function(){for(var a=f.getWorks(),b=[],c=0;c<a.length;c++)b.push(a[c].getPublicInterface());return b},getSessionId:function(){return g.connection.getSessionId()},getSessionKey:function(){return g.connection.getSessionKey()},
getAffinityToken:function(){return g.connection.getAffinityToken()},isRunning:function(){return g.connection.isRunning()},getClientChannels:function(){return u},registerClientChannel:function(a,b,c,e,d){a=a.toLowerCase();J[a]=b;G[a]=c;D[a]=e;-1==u.indexOf(a)&&u.push(a);d&&(Q[a]=d);return g},unregisterClientChannel:function(a){a=a.toLowerCase();a=u.indexOf(a);0<=a&&u.splice(a,1)},addWork:function(a,b,c,e,d,g){a=new M(a,b,c,e,d,g);b=f.getTotalWorkload();f.add(a);k(h.WORK_ASSIGNED,a.getPublicInterface());
b!=f.getTotalWorkload()&&(b=new r(n.getPublicInterface().getCapacity(),b,f.getTotalWorkload()),k(h.WORKLOAD_CHANGED,b.getPublicInterface()));return a.getPublicInterface()},checkClientWork:function(a,b,c,e){return p.checkClientWork(a,b,c,e)},isAtCapacity:function(a){var b=servicepresence.getWorkload(),c=n.getPublicInterface().getCapacity();return void 0!==a&&null!==a?(b+=Math.round(a/100),0<b&&b>c):0<b&&b>=c},getWorkload:function(){return f.getTotalWorkload()},getActiveTimeTracker:function(){return t?
t.getPublicInterface():null},sendActiveTime:function(a){if(0<a.length)return p.sendActiveTime(a)}};(function(a){var b={};a.addEventListener=function(a,e,d){"undefined"==typeof d&&(d="");b[a]||(b[a]=[]);b[a].push({listenerId:d,handler:e})};a.dispatchEvent=function(a,e){b[a]&&b[a].forEach(function(a){try{a.handler.call(window,e)}catch(b){m.error(b)}})};a.removeEventListeners=function(a){if("undefined"==typeof a)b={};else for(var e in b)if(b.hasOwnProperty(e))for(var d=b[e].length;d--;)b[e][d].listenerId==
a&&b[e].splice(d,1)}})(window.servicepresence)})();